const fs = require("fs-extra");
const path = require("path");
const uppercamelize = require("uppercamelcase");
const Components = require("./get-components")();
const pkg = require("../package.json");

const version = process.env.VERSION || pkg.version;
const tips = "// This file is auto generated by build/build-entry.js";

(function() {
  const importList = Components.map(
    (name) => `import ${uppercamelize(name)} from "./${name}";`
  );
  const exportList = Components.map((name) => `${uppercamelize(name)}`);
  const content = `${tips}\n
${importList.join("\n")}

const version = "${version}";
const components = [
  ${exportList.join(",\n  ")}
];

const install = (Vue) => {
  components.forEach((Component) => {
    Vue.use(Component);
  });
};

if (typeof window !== "undefined" && window.Vue) {
  install(window.Vue);
}

export {
  install,
  version,
  ${exportList.join(",\n  ")}
};

export default {
  install,
  version
};
`;

  fs.writeFileSync(path.join(__dirname, "../src/index.js"), content);
})();
